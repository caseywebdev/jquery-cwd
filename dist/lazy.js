// Generated by CoffeeScript 1.4.0
(function() {
  var Lazy;

  Lazy = {
    $els: $(),
    init: _.once(function() {
      return $(window).on('scroll resize', function() {
        return Lazy.check(Lazy.$els);
      });
    }),
    check: function($imgs) {
      $imgs.each(function() {
        var $t;
        $t = $(this);
        return _.defer(function() {
          var fold, showLine, visible;
          visible = _.reduce($t.parents().toArray(), function(memo, parent) {
            return memo && $(parent).css('display') !== 'none' && $(parent).css('visibility') !== 'hidden';
          }, true);
          fold = $(window).scrollTop() + $(window).outerHeight();
          showLine = $t.offset().top - $t.data().lazyTolerance;
          if (visible && fold >= showLine) {
            $t.attr('src', $t.data().lazySrc);
            return Lazy.$els = Lazy.$els.not($t);
          }
        });
      });
      return $imgs;
    }
  };

  $.fn.lazy = function(src, options) {
    var $t, tolerance;
    if (options == null) {
      options = {};
    }
    tolerance = options.tolerance;
    if (tolerance == null) {
      tolerance = 100;
    }
    $t = $(this);
    Lazy.init();
    Lazy.$els = Lazy.$els.add($t.data({
      lazySrc: src,
      lazyTolerance: tolerance
    }));
    return Lazy.check($t);
  };

}).call(this);
