// Generated by CoffeeScript 1.3.3
(function() {
  var Placeholder;

  Placeholder = {
    bind: function() {
      var val;
      val = $.fn.val;
      return $.fn.val = function(str) {
        var $t, data;
        $t = $(this);
        data = $t.data() || {};
        if (str === void 0) {
          if (data.placeholderIsEmpty) {
            return '';
          } else {
            return val.call($t);
          }
        } else {
          if ((data.placeholderIsEmpty != null) && !$t.is(':focus')) {
            if (str === '' || str === null) {
              $t.data({
                placeholderIsEmpty: true
              });
              val.call($t, data.placeholderText);
              if (data.placeholderIsPassword) {
                $t[0].type = 'text';
              }
            } else {
              val.call($t, str);
              if (data.placeholderIsPassword) {
                $t[0].type = 'password';
              }
              $t.data({
                placeholderIsEmpty: false
              });
            }
          } else {
            val.call($t, str);
          }
          return $t;
        }
      };
    },
    listeners: {
      focus: function() {
        var $t;
        $t = $(this);
        return _.defer(function() {
          if ($t.data().placeholderIsPassword) {
            $t[0].type = 'password';
          }
          if ($t.data().placeholderIsEmpty) {
            $t.val('');
          }
          return $t.data({
            placeholderIsEmpty: false
          });
        });
      },
      blur: function() {
        var $t;
        $t = $(this);
        return _.defer(function() {
          if (!$t.val()) {
            return $t.val('');
          }
        });
      }
    }
  };

  Placeholder.init = _.once(Placeholder.bind);

  $.fn.placeholder = function(text, options) {
    var password;
    if (options == null) {
      options = {};
    }
    password = options.password;
    Placeholder.init();
    return $(this).each(function() {
      var $t;
      if (($t = $(this)).data().placeholderIsEmpty == null) {
        if (password) {
          $t[0].type = 'password';
        }
        if (!(password && $.browser.msie && $.browser.version.split('.')[0] < 9)) {
          $t.data({
            placeholderText: text,
            placeholderIsEmpty: false,
            placeholderIsPassword: password
          });
          if (!$t.val() || $t.val() === text) {
            $t.val('');
          }
          return $t.attr({
            placeholder: text,
            title: text
          }).on(Placeholder.listeners);
        }
      }
    });
  };

}).call(this);
